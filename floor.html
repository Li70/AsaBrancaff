
<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Cliente ‚Äì Pedido</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark; }
    body { background:#0b1020; color:#fff; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial; }
    .card { background:#0f172a; border:1px solid rgba(255,255,255,0.08); }
    .btn  { padding:.6rem .9rem; border-radius:.9rem; font-weight:700; }
    .muted{ color:rgba(255,255,255,.75) }
    .pill { font-size:.75rem; padding:.15rem .5rem; border-radius:.5rem; background:#0b1226; border:1px solid rgba(255,255,255,.08); }
  </style>

<body class="p-4 pb-28">
  <div class="max-w-6xl mx-auto">
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4">
      <h1 class="text-2xl font-bold">üçΩÔ∏è Fa√ßa o seu pedido</h1>
      <div class="muted text-sm">Selecione a mesa, escolha produtos por categoria e envie para o staff.</div>
    </header>

    <!-- Mesa -->
    <section class="card p-4 rounded-2xl mb-4">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">Indique o n√∫mero da sua mesa</h2>
        <span class="muted text-sm">Mesa selecionada: <span id="selectedTable" class="font-semibold">Nenhuma</span></span>
      </div>
      <div id="floor" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 xl:grid-cols-12 gap-2"></div>
    </section>

    <div class="grid lg:grid-cols-[2fr_1fr] gap-4">
      <div id="menuCol" class="space-y-4">
        <!-- Categorias e Itens ser√£o injetados via JS -->
      </div>

      <aside class="card p-4 rounded-2xl sticky top-4 h-fit">
        <h2 class="text-lg font-semibold mb-2">üß∫ Carrinho</h2>
        <div id="cartList" class="space-y-2 mb-3"></div>
        <div class="flex items-center justify-between mb-3">
          <span class="muted">Total</span><strong id="cartTotal">0$00</strong>
        </div>
        <label class="muted text-sm">Observa√ß√µes (opcional)</label>
        <textarea id="notes" rows="2" class="w-full mt-1 px-3 py-2 rounded-xl bg-slate-800 border border-slate-700"
          placeholder="Sem cebola, extra queijo..."></textarea>
        <button id="sendBtn" class="w-full btn bg-emerald-600 hover:bg-emerald-700 mt-3">Passar encomenda ‚Üí</button>
        <p class="muted text-xs mt-2">O staff confirma e s√≥ depois a cozinha recebe.</p>
      </aside>
    </div>
  </div>

  <script>
    // ===== Simple dataset (send unitPrice so Staff can somar sem cat√°logos locais) =====
    const CATS = [
      { name:'üçï Pizzas', items:[
        {id:'pz-peperoni', name:'PEPERONI', priceNum:800, price:'800$00'},
        {id:'pz-hawaii-ii', name:'HAWAII-II', priceNum:800, price:'800$00'},
        {id:'pz-atum', name:'ATUM', priceNum:800, price:'800$00'}
      ]},
      { name:'üçî Hamb√∫rgueres', items:[
        {id:'burg-cheeseburger', name:'CL√ÅSSICO CHEESEBURGER', priceNum:250, price:'250$00'},
        {id:'burg-bigmac', name:'BIG MAC BURGER', priceNum:500, price:'500$00'}
      ]},
      { name:'üçó Fried Chicken', items:[
        {id:'legs', name:'LEGS', priceNum:200, price:'200$00'},
        {id:'wings-plain', name:'WINGS', priceNum:200, price:'200$00'},
        {id:'fried-chicken', name:'FRIED CHICKEN', priceNum:300, price:'300$00'}
      ]},
      { name:'üåØ Shawarma', items:[
        {id:'shawarma-galinha', name:'SHAWARMA DE GALINHA', priceNum:400, price:'400$00'},
        {id:'doner', name:'DONER KEBAB', priceNum:500, price:'500$00'}
      ]},
      { name:'ü•§ Bebidas', items:[
        {id:'coca15', name:'Coca-Cola 1,5L', priceNum:250, price:'250$00'},
        {id:'compal1', name:'Compal 1L', priceNum:300, price:'300$00'}
      ]},
    ];

    const formatCVE = n => `${Math.floor(Number(n)||0)}$00`;
    const cart = {};
    let selectedTable = null;

    function byId(id){ return document.getElementById(id); }

    // mesas 1..24
    const floor = byId('floor');
    for(let i=1;i<=24;i++){
      const b = document.createElement('button');
      b.className='table bg-slate-800 hover:bg-slate-700 rounded-xl h-12 font-bold';
      b.textContent = i;
      b.addEventListener('click', ()=>{ selectedTable = i; byId('selectedTable').textContent = i; document.querySelectorAll('.table').forEach(x=>x.classList.remove('outline')); b.classList.add('outline','outline-emerald-500'); });
      floor.appendChild(b);
    }

    // render cat√°logo
    const menuCol = byId('menuCol');
    CATS.forEach(cat=>{
      const sec = document.createElement('section');
      sec.className='card p-4 rounded-2xl';
      sec.innerHTML = `<div class="flex items-center justify-between mb-3"><h2 class="text-lg font-semibold">${cat.name}</h2></div>`;
      const list = document.createElement('div');
      list.className='space-y-2';
      cat.items.forEach(it=>{
        const row = document.createElement('div');
        row.className='flex items-center justify-between gap-3';
        row.innerHTML = `<div><div class="font-extrabold">${it.name}</div><div class="muted text-sm">${it.price}</div></div>`;
        const right = document.createElement('div');
        const btn = document.createElement('button');
        btn.className='btn bg-slate-700 hover:bg-slate-600';
        btn.textContent = 'Adicionar';
        btn.addEventListener('click', ()=>addToCart(it));
        right.appendChild(btn);
        row.appendChild(right);
        list.appendChild(row);
      });
      sec.appendChild(list);
      menuCol.appendChild(sec);
    });

    function addToCart(it){
      const key = it.id;
      cart[key] = cart[key] || { name: it.name, qty: 0, unitPrice: it.priceNum };
      cart[key].qty += 1;
      renderCart();
    }

    function renderCart(){
      const wrap = byId('cartList'); wrap.innerHTML='';
      let total = 0;
      Object.keys(cart).forEach(k=>{
        const it = cart[k];
        total += (it.unitPrice||0) * (it.qty||0);
        const div = document.createElement('div');
        div.className='flex items-center justify-between gap-3 p-2 bg-slate-800 rounded-xl';
        div.innerHTML = `<div><div class="font-semibold">${it.qty} √ó ${it.name}</div><div class="muted text-xs">${formatCVE(it.unitPrice)}</div></div>`;
        const minus = document.createElement('button'); minus.className='btn bg-slate-700'; minus.textContent='-';
        const plus  = document.createElement('button'); plus.className='btn bg-slate-700'; plus.textContent='+';
        minus.addEventListener('click', ()=>{ it.qty=Math.max(0,(it.qty||0)-1); if(it.qty===0) delete cart[k]; renderCart(); });
        plus.addEventListener('click', ()=>{ it.qty=(it.qty||0)+1; renderCart(); });
        const box = document.createElement('div'); box.className='flex gap-2'; box.appendChild(minus); box.appendChild(plus);
        div.appendChild(box);
        wrap.appendChild(div);
      });
      byId('cartTotal').textContent = formatCVE(total);
    }
  </script>

  
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
  import { 
    getFirestore, collection, doc, setDoc, addDoc, updateDoc, onSnapshot, query, where, orderBy, serverTimestamp, getDoc 
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
  import { getStorage, ref as sRef, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-storage.js";

  // Using the same public config you shared in your files (client keys; safe for web apps)
  const firebaseConfig = {
    apiKey: "AIzaSyBTYSRTrdY-vml4LdsIYxYQfQt0K2GbReM",
    authDomain: "asabrancaff-faebe.firebaseapp.com",
    projectId: "asabrancaff-faebe",
    storageBucket: "asabrancaff-faebe.appspot.com",
    messagingSenderId: "326390762122",
    appId: "1:326390762122:web:919c53bd8d0cf9c34dbb73"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);
  const auth = getAuth(app);
  const storage = getStorage(app);
  signInAnonymously(auth).catch(()=>{});
  onAuthStateChanged(auth, ()=>{});

  // Expose for the page
  window.__fb = { app, db, auth, storage, collection, doc, setDoc, addDoc, updateDoc, onSnapshot, query, where, orderBy, serverTimestamp, getDoc, sRef, getDownloadURL };
</script>


  <script type="module">
    const { db, addDoc, collection, serverTimestamp } = window.__fb;

    function gatherItems(){
      return Object.keys(cart).map(k=>{
        const it = cart[k]; return { name: it.name, qty: Number(it.qty||1), unitPrice: Number(it.unitPrice||0) };
      });
    }

    function gatherTotal(items){
      return items.reduce((s,it)=> s + (Number(it.unitPrice||0) * Number(it.qty||1)), 0);
    }

    document.getElementById('sendBtn').addEventListener('click', async ()=>{
      if(!selectedTable){ alert('Selecione a sua mesa primeiro.'); return; }
      const items = gatherItems();
      if(items.length===0){ alert('Adicione itens ao carrinho.'); return; }
      const notes = (document.getElementById('notes').value||'').trim();
      const orderId = Date.now().toString(36) + Math.random().toString(36).slice(2,6);
      const totalCVE = gatherTotal(items);
      try{
        await addDoc(collection(db, 'orders'), {
          orderId, table: String(selectedTable), items, notes,
          totalCVE, confirmed: false, isReady: false, servedAt: null, rejectedAt: null,
          createdAt: serverTimestamp(), updatedAt: serverTimestamp()
        });
        Object.keys(cart).forEach(k=>delete cart[k]); renderCart(); document.getElementById('notes').value='';
        alert('Pedido enviado ao staff para confirma√ß√£o!');
      }catch(e){
        alert('Falha ao enviar o pedido. Verifique a internet.');
        console.warn(e);
      }
    });
  </script>

</body>
</html>
